# RUN: llc -mtriple=x86_64-linux-gnu -global-isel -run-pass=legalizer %s -o - | FileCheck %s
--- |

  define void @test_ashr() { ret void }
  define void @test_ashr_i1() { ret void }
...
---
name:            test_ashr
# CHECK-LABEL: name:  test_ashr
alignment:       4
legalized:       false
regBankSelected: false
tracksRegLiveness: true
registers:
  - { id: 0, class: _, preferred-register: '' }
  - { id: 1, class: _, preferred-register: '' }
  - { id: 2, class: _, preferred-register: '' }
  - { id: 3, class: _, preferred-register: '' }
  - { id: 4, class: _, preferred-register: '' }
  - { id: 5, class: _, preferred-register: '' }
  - { id: 6, class: _, preferred-register: '' }
  - { id: 7, class: _, preferred-register: '' }
  - { id: 8, class: _, preferred-register: '' }
  - { id: 9, class: _, preferred-register: '' }
  - { id: 10, class: _, preferred-register: '' }
  - { id: 11, class: _, preferred-register: '' }
# CHECK:          %0(s64) = COPY %rdi
# CHECK-NEXT:     %1(s64) = COPY %rsi
# CHECK-NEXT:     %2(s64) = G_ASHR %0, %1
# CHECK-NEXT:     %3(s32) = G_TRUNC %0(s64)
# CHECK-NEXT:     %4(s32) = G_TRUNC %1(s64)
# CHECK-NEXT:     %5(s32) = G_ASHR %3, %4
# CHECK-NEXT:     %6(s16) = G_TRUNC %0(s64)
# CHECK-NEXT:     %7(s16) = G_TRUNC %1(s64)
# CHECK-NEXT:     %8(s16) = G_ASHR %6, %7
# CHECK-NEXT:     %9(s8) = G_TRUNC %0(s64)
# CHECK-NEXT:     %10(s8) = G_TRUNC %1(s64)
# CHECK-NEXT:     %11(s8) = G_ASHR %9, %10
# CHECK-NEXT:     RET 0
body:             |
  bb.1 (%ir-block.0):
    liveins: %rdi, %rsi

    %0(s64) = COPY %rdi
    %1(s64) = COPY %rsi
    %2(s64) = G_ASHR %0, %1

    %3(s32) = G_TRUNC %0
    %4(s32) = G_TRUNC %1
    %5(s32) = G_ASHR %3, %4

    %6(s16) = G_TRUNC %0
    %7(s16) = G_TRUNC %1
    %8(s16) = G_ASHR %6, %7

    %9(s8) = G_TRUNC %0
    %10(s8) = G_TRUNC %1
    %11(s8) = G_ASHR %9, %10

    RET 0

...
---
name:            test_ashr_i1
# CHECK-LABEL: name:  test_ashr_i1
alignment:       4
legalized:       false
regBankSelected: false
tracksRegLiveness: true
registers:
  - { id: 0, class: _, preferred-register: '' }
  - { id: 1, class: _, preferred-register: '' }
  - { id: 2, class: _, preferred-register: '' }
  - { id: 3, class: _, preferred-register: '' }
  - { id: 4, class: _, preferred-register: '' }
# CHECK:          %0(s64) = COPY %rdi
# CHECK-NEXT:     %1(s64) = COPY %rsi
# CHECK-NEXT:     %11(s8) = G_CONSTANT i8 7
# CHECK-NEXT:     %12(s8) = G_TRUNC %0(s64)
# CHECK-NEXT:     %13(s8) = G_SHL %12, %11
# CHECK-NEXT:     %5(s8) = G_ASHR %13, %11
# CHECK-NEXT:     %8(s8) = G_CONSTANT i8 7
# CHECK-NEXT:     %9(s8) = G_TRUNC %1(s64)
# CHECK-NEXT:     %10(s8) = G_SHL %9, %8
# CHECK-NEXT:     %6(s8) = G_ASHR %10, %8
# CHECK-NEXT:     %7(s8) = G_ASHR %5, %6
# CHECK-NEXT:     %4(s1) = G_TRUNC %7(s8)
# CHECK-NEXT:     RET 0
body:             |
  bb.1 (%ir-block.0):
    liveins: %rdi, %rsi

    %0(s64) = COPY %rdi
    %1(s64) = COPY %rsi
    %2(s1) = G_TRUNC %0
    %3(s1) = G_TRUNC %1
    %4(s1) = G_ASHR %2, %3

    RET 0

...
